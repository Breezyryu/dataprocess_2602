# ìµœì í™”ëœ ë°ì´í„° êµ¬ì¡° - ìµœì¢… ë²„ì „

## ğŸ“‹ ê°œìš”

ë°ì´í„° ì¤‘ë³µì„ ë°©ì§€í•˜ê³  ë©”ëª¨ë¦¬ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ìµœì í™”ëœ ë°ì´í„° êµ¬ì¡°ë¥¼ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

### í•µì‹¬ ì›ì¹™
1. **profile**: ëª¨ë“  ì‚¬ì´í´ DataFrameì„ í•œ ë²ˆë§Œ ì €ì¥ (ê° DataFrameì— `category` ì»¬ëŸ¼ ì¶”ê°€)
2. **cycle_list**: ì¹´í…Œê³ ë¦¬ë³„ **ì¸ë±ìŠ¤ë§Œ** ì €ì¥ (DataFrame ë³µì‚¬ë³¸ ì €ì¥ ì•ˆ í•¨)

## ğŸ¯ ìµœì í™”ëœ ë°ì´í„° êµ¬ì¡°

```python
data['channels'][channel_key] = {
    'profile': [
        cycle_0_df,  # 'category' ì»¬ëŸ¼ í¬í•¨
        cycle_1_df,  # 'category' ì»¬ëŸ¼ í¬í•¨
        cycle_2_df,  # 'category' ì»¬ëŸ¼ í¬í•¨
        ...
    ],
    'cycle_list': {
        'Unknown': [0, 501, 600],           # ì¸ë±ìŠ¤ë§Œ
        'RPT': [1, 101, 201, 300, 400, 500],
        'SOC_Definition': [2, 102, 202, 301, 401],
        'Resistance_Measurement': [3, 103, 203, 302, 402, 502],
        'Accelerated_Aging': [4, 5, 6, 7, ...]
    }
}
```

## ğŸ”§ êµ¬í˜„ ì„¸ë¶€ì‚¬í•­

### `channel_categorizer.categorize_all_channels(data)`

```python
def categorize_all_channels(data):
    """
    Returns:
    --------
    dict : ì…ë ¥ëœ data ê°ì²´ (ê° ì±„ë„ì— ì¹´í…Œê³ ë¦¬ ì •ë³´ê°€ ì¶”ê°€ë¨)
        - data['channels'][channel_key]['profile'][i]ì— 'category' ì»¬ëŸ¼ ì¶”ê°€
        - data['channels'][channel_key]['cycle_list'] = {
            'Unknown': [0, 1, 2, ...],  # ì¸ë±ìŠ¤ ë¦¬ìŠ¤íŠ¸
            'RPT': [3, 4, ...],
            ...
          }
    """
    
    for channel_key, channel_data in data['channels'].items():
        cycle_list = channel_data['profile']
        
        # ì¹´í…Œê³ ë¦¬í™” ìˆ˜í–‰
        categories = cycle_categorizer.categorize_cycles(cycle_list)
        
        # ê° ì‚¬ì´í´ DataFrameì— category ì»¬ëŸ¼ ì¶”ê°€
        for category, indices in categories.items():
            for idx in indices:
                cycle_list[idx]['category'] = category
        
        # cycle_listì—ëŠ” ì¹´í…Œê³ ë¦¬ë³„ ì¸ë±ìŠ¤ë§Œ ì €ì¥ (ë°ì´í„° ì¤‘ë³µ ë°©ì§€)
        channel_data['cycle_list'] = categories
    
    return data
```

## ğŸ“Š ì‚¬ìš© ë°©ë²•

### ê¸°ë³¸ ì‚¬ìš©ë²•

```python
import importlib
importlib.reload(channel_categorizer)

# ë°ì´í„° ì²˜ë¦¬
data = cycle_list_processor.process_all_channels(data)
data = channel_categorizer.categorize_all_channels(data)

# ì±„ë„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
channel_key = list(data['channels'].keys())[0]
profile = data['channels'][channel_key]['profile']
cycle_list = data['channels'][channel_key]['cycle_list']
```

### ì¹´í…Œê³ ë¦¬ë³„ ì‚¬ì´í´ ì ‘ê·¼

#### ë°©ë²• 1: ì¸ë±ìŠ¤ë¡œ ì§ì ‘ ì ‘ê·¼ (ê°€ì¥ íš¨ìœ¨ì )

```python
# RPT ì¸ë±ìŠ¤ ê°€ì ¸ì˜¤ê¸°
rpt_indices = data['channels'][channel_key]['cycle_list']['RPT']
# [1, 101, 201, 300, 400, 500]

# ì¸ë±ìŠ¤ë¡œ profileì—ì„œ ì‚¬ì´í´ ê°€ì ¸ì˜¤ê¸°
profile = data['channels'][channel_key]['profile']
rpt_cycles = [profile[i] for i in rpt_indices]

# ì²« ë²ˆì§¸ RPT ì‚¬ì´í´
first_rpt = profile[rpt_indices[0]]
```

#### ë°©ë²• 2: í—¬í¼ í•¨ìˆ˜ - ì¸ë±ìŠ¤ë§Œ

```python
# ì¸ë±ìŠ¤ ë¦¬ìŠ¤íŠ¸ë§Œ í•„ìš”í•œ ê²½ìš°
rpt_indices = channel_categorizer.get_category_indices(
    data, 
    channel_index=0, 
    category='RPT'
)
```

#### ë°©ë²• 3: í—¬í¼ í•¨ìˆ˜ - DataFrame ë¦¬ìŠ¤íŠ¸

```python
# DataFrame ë¦¬ìŠ¤íŠ¸ê°€ ë°”ë¡œ í•„ìš”í•œ ê²½ìš°
rpt_cycles = channel_categorizer.get_category_cycles(
    data, 
    channel_index=0, 
    category='RPT'
)
```

#### ë°©ë²• 4: category ì»¬ëŸ¼ìœ¼ë¡œ í•„í„°ë§

```python
# profileì˜ category ì»¬ëŸ¼ ì‚¬ìš©
profile = data['channels'][channel_key]['profile']
rpt_cycles = [
    cycle for cycle in profile 
    if 'category' in cycle.columns and cycle['category'].iloc[0] == 'RPT'
]
```

### ë‹¤ì¤‘ ì±„ë„ ì²˜ë¦¬

```python
# ëª¨ë“  ì±„ë„ì˜ RPT ì‚¬ì´í´ ì²˜ë¦¬
for channel_key, channel_data in data['channels'].items():
    if 'cycle_list' in channel_data:
        rpt_indices = channel_data['cycle_list']['RPT']
        profile = channel_data['profile']
        
        for idx in rpt_indices:
            rpt_cycle = profile[idx]
            # ì²˜ë¦¬ ë¡œì§...
```

## ğŸ”‘ ì£¼ìš” ì¥ì 

### 1. ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±
```python
# âŒ ì´ì „ ë°©ì‹ (ë°ì´í„° ì¤‘ë³µ)
cycle_list = {
    'RPT': [cycle_df_1, cycle_df_2, ...],      # DataFrame ë³µì‚¬ë³¸
    'Accelerated_Aging': [cycle_df_3, ...]     # DataFrame ë³µì‚¬ë³¸
}
# ë©”ëª¨ë¦¬: profile í¬ê¸° + cycle_list í¬ê¸° (DataFrame ë³µì‚¬ë³¸ë“¤)

# âœ… ìƒˆë¡œìš´ ë°©ì‹ (ì¸ë±ìŠ¤ë§Œ)
cycle_list = {
    'RPT': [1, 101, 201, ...],                 # ì¸ë±ìŠ¤ë§Œ
    'Accelerated_Aging': [4, 5, 6, ...]        # ì¸ë±ìŠ¤ë§Œ
}
# ë©”ëª¨ë¦¬: profile í¬ê¸° + cycle_list í¬ê¸° (ì¸ë±ìŠ¤ë§Œ, ë§¤ìš° ì‘ìŒ)
```

### 2. ë°ì´í„° ì¼ê´€ì„±
- profileì˜ ê° ì‚¬ì´í´ DataFrameì— `category` ì»¬ëŸ¼ì´ í¬í•¨ë˜ì–´ ìˆì–´ ë©”íƒ€ë°ì´í„°ê°€ í•¨ê»˜ ì €ì¥ë¨
- ë³„ë„ë¡œ ì¹´í…Œê³ ë¦¬ ì •ë³´ë¥¼ ê´€ë¦¬í•  í•„ìš” ì—†ìŒ

### 3. ìœ ì—°í•œ ì ‘ê·¼
- ì¸ë±ìŠ¤ë¡œ ë¹ ë¥¸ ì ‘ê·¼
- category ì»¬ëŸ¼ìœ¼ë¡œ í•„í„°ë§
- í—¬í¼ í•¨ìˆ˜ë¡œ í¸ë¦¬í•œ ì ‘ê·¼

### 4. í™•ì¥ì„±
- ìƒˆë¡œìš´ ì¹´í…Œê³ ë¦¬ ì¶”ê°€ ìš©ì´
- ë‹¤ë¥¸ ë©”íƒ€ë°ì´í„° ì»¬ëŸ¼ ì¶”ê°€ ê°€ëŠ¥

## ğŸ“ í—¬í¼ í•¨ìˆ˜

### `get_category_cycles(data, channel_index=0, category='RPT')`

ì¹´í…Œê³ ë¦¬ë³„ ì‚¬ì´í´ DataFrame ë¦¬ìŠ¤íŠ¸ ë°˜í™˜

**Returns:** `list[DataFrame]`

```python
rpt_cycles = channel_categorizer.get_category_cycles(data, 0, 'RPT')
# [cycle_df_1, cycle_df_101, cycle_df_201, ...]
```

### `get_category_indices(data, channel_index=0, category='RPT')`

ì¹´í…Œê³ ë¦¬ë³„ ì‚¬ì´í´ ì¸ë±ìŠ¤ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜

**Returns:** `list[int]`

```python
rpt_indices = channel_categorizer.get_category_indices(data, 0, 'RPT')
# [1, 101, 201, 300, 400, 500]
```

### `print_channel_categorization(data, channel_index=0)`

ì±„ë„ì˜ ì¹´í…Œê³ ë¦¬í™” ê²°ê³¼ ìƒì„¸ ì¶œë ¥

```python
channel_categorizer.print_channel_categorization(data, 0)
```

## ğŸ’¡ ì‚¬ìš© ì˜ˆì‹œ

### ì˜ˆì‹œ 1: RPT ì‚¬ì´í´ ë¶„ì„

```python
# RPT ì‚¬ì´í´ë§Œ ê°€ì ¸ì˜¤ê¸°
rpt_cycles = channel_categorizer.get_category_cycles(data, 0, 'RPT')

# ê° RPT ì‚¬ì´í´ ë¶„ì„
for i, cycle in enumerate(rpt_cycles):
    voltage = cycle['Voltage_V']
    capacity = cycle['DchgCap_mAh']
    print(f"RPT {i}: ìµœì¢… ìš©ëŸ‰ = {capacity.iloc[-1]:.2f} mAh")
```

### ì˜ˆì‹œ 2: ì¹´í…Œê³ ë¦¬ë³„ í†µê³„

```python
channel_key = list(data['channels'].keys())[0]
profile = data['channels'][channel_key]['profile']
cycle_list = data['channels'][channel_key]['cycle_list']

for category, indices in cycle_list.items():
    cycles = [profile[i] for i in indices]
    avg_capacity = sum(c['DchgCap_mAh'].iloc[-1] for c in cycles) / len(cycles)
    print(f"{category}: í‰ê·  ìš©ëŸ‰ = {avg_capacity:.2f} mAh")
```

### ì˜ˆì‹œ 3: category ì»¬ëŸ¼ í™œìš©

```python
# ì²« ë²ˆì§¸ ì‚¬ì´í´ì˜ ì¹´í…Œê³ ë¦¬ í™•ì¸
first_cycle = profile[0]
category = first_cycle['category'].iloc[0]
print(f"ì²« ë²ˆì§¸ ì‚¬ì´í´ ì¹´í…Œê³ ë¦¬: {category}")

# ëª¨ë“  ì‚¬ì´í´ì˜ ì¹´í…Œê³ ë¦¬ ë¶„í¬
categories = [cycle['category'].iloc[0] for cycle in profile]
from collections import Counter
print(Counter(categories))
```

## âœ… ì™„ë£Œëœ ì‘ì—…

1. âœ… `channel_categorizer.py` ìµœì í™”
   - profileì— `category` ì»¬ëŸ¼ ì¶”ê°€
   - cycle_listì— ì¸ë±ìŠ¤ë§Œ ì €ì¥
2. âœ… í—¬í¼ í•¨ìˆ˜ ì—…ë°ì´íŠ¸
   - `get_category_cycles()`: DataFrame ë¦¬ìŠ¤íŠ¸ ë°˜í™˜
   - `get_category_indices()`: ì¸ë±ìŠ¤ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜ (ì‹ ê·œ)
   - `print_channel_categorization()`: ì¸ë±ìŠ¤ ê¸°ë°˜ ì¶œë ¥
3. âœ… ì‚¬ìš© ì˜ˆì‹œ ì‘ì„±
   - [`example_optimized_structure.py`](file:///c:/Users/Ryu/Python_project/data/dataprocess_2601/example_optimized_structure.py)

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„

ë…¸íŠ¸ë¶ì—ì„œ ì‚¬ìš©í•˜ê¸°:

```python
import importlib
importlib.reload(channel_categorizer)

# ë°ì´í„° ì²˜ë¦¬
data = cycle_list_processor.process_all_channels(data)
data = channel_categorizer.categorize_all_channels(data)

# ì¹´í…Œê³ ë¦¬ë³„ ì ‘ê·¼
channel_key = list(data['channels'].keys())[0]

# ë°©ë²• 1: ì¸ë±ìŠ¤ë¡œ ì§ì ‘ ì ‘ê·¼
rpt_indices = data['channels'][channel_key]['cycle_list']['RPT']
rpt_cycles = [data['channels'][channel_key]['profile'][i] for i in rpt_indices]

# ë°©ë²• 2: í—¬í¼ í•¨ìˆ˜ ì‚¬ìš©
rpt_cycles = channel_categorizer.get_category_cycles(data, 0, 'RPT')
```

## ğŸ“ˆ ì„±ëŠ¥ ë¹„êµ

| í•­ëª© | ì´ì „ ë°©ì‹ (ë³µì‚¬ë³¸) | ìµœì í™”ëœ ë°©ì‹ (ì¸ë±ìŠ¤) |
|------|-------------------|---------------------|
| ë©”ëª¨ë¦¬ ì‚¬ìš© | profile + cycle_list (DataFrame ë³µì‚¬ë³¸) | profile + cycle_list (ì¸ë±ìŠ¤ë§Œ) |
| ë°ì´í„° ì¤‘ë³µ | âœ— ìˆìŒ | âœ… ì—†ìŒ |
| ì ‘ê·¼ ì†ë„ | ë¹ ë¦„ | ë§¤ìš° ë¹ ë¦„ (ì¸ë±ìŠ¤ ì ‘ê·¼) |
| ìœ ì§€ë³´ìˆ˜ | ë³µì¡ (ë‘ ê³³ ê´€ë¦¬) | ê°„ë‹¨ (profileë§Œ ê´€ë¦¬) |
| í™•ì¥ì„± | ì œí•œì  | ìš°ìˆ˜ |

---

**ê²°ë¡ :** ìµœì í™”ëœ ë°ì´í„° êµ¬ì¡°ëŠ” ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±ê³¼ ë°ì´í„° ì¼ê´€ì„±ì„ ëª¨ë‘ ì œê³µí•˜ë©°, ìœ ì—°í•œ ì ‘ê·¼ ë°©ë²•ì„ í†µí•´ ë‹¤ì–‘í•œ ì‚¬ìš© ì‚¬ë¡€ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.
